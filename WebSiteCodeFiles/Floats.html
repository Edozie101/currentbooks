<HTML><HEAD><TITLE>Floats functions</TITLE></HEAD><BODY><H2 ALIGN="center">Functions for cast member "Floats" of castlib "math"</H2><P><PRE><KBD><A NAME="decbin"> </A>on decbin n<BR> --! ARGUMENTS: n (a number)<BR> --! RETURNS: the equivalent string in binary<BR> return <A HREF="Floats.html#base">base</A>(n,2)<BR>end<BR><HR><A NAME="bindec"> </A>on bindec s<BR> --! ARGUMENTS: s (a string in binary)<BR> --! RETURNS: the equivalent string in decimal<BR> return <A HREF="Floats.html#frombase">frombase</A>(s,2)<BR>end<BR><HR><A NAME="base"> </A>on base n, b<BR> --! ARGUMENTS: n (a number); b (a positive integer &#060;=10)<BR> --! RETURNS: the equivalent string to n in base b<BR> --! Converts any number into any base (including a float)<BR> --! Basically the same as <A HREF="Chapter 1.html#NumberToBaseString">NumberToBaseString</A> (but not recursive)<BR> if n&#060;0 then return "-"&base(-n,b)<BR> set Output to ""<BR> -- calculate integer part<BR> set integerPart to <A HREF="numerical utilities.html#floor">floor</A>(n)<BR> repeat while integerPart&#062;0<BR> set r to integerPart mod b<BR> set Output to r & Output<BR> set integerPart to (integerPart-r)/b<BR> end repeat<BR> -- if n is an integer then we're done<BR> if integerp(n) then return Output<BR> -- otherwise write a radix point and continue<BR> set Output to Output & "."<BR> set rem to n - <A HREF="numerical utilities.html#floor">floor</A>(n)<BR> repeat while rem&#062;0<BR> set rem to rem*b<BR> set r to <A HREF="numerical utilities.html#floor">floor</A>(rem)<BR> set Output to Output & r<BR> set rem to rem-r<BR> end repeat<BR> <BR> return Output<BR>end<BR><HR><A NAME="frombase"> </A>on frombase s,b<BR> --! ARGUMENTS: s (a digit string); b (a positive integer &#060;=10)<BR> --! RETURNS: the equivalent string to n in <A HREF="Floats.html#base">base</A> b<BR> --! Converts any <A HREF="Floats.html#base">base</A> string to a number (including a float)<BR> set Output to 0<BR> if s contains "." then set m to 1.0<BR> else set m to 1<BR> repeat with i=s.length down to 1<BR> c=s.char&#091;i&#093;<BR> if c="." then <BR> -- the previous calculation was for the non-integer part: <BR> -- divide by the current exponent and start again<BR> set Output to Output/m<BR> set m to 1<BR> else<BR> -- add m* the current digit to the output and multiply m by b<BR> set k to value(c)<BR> set Output to Output+k*m<BR> set m to m*b<BR> end if<BR> <BR> end repeat<BR> <BR> return Output<BR>end<BR><HR><A NAME="bintens"> </A>on bintens b, p, m<BR> --! ARGUMENTS: b (a binary digit string), p (an integer), m (a positive integer)<BR> --! RETURNS: the first m digits of the number b*10^p<BR> if p=0 then return b -- 10^0=1<BR> -- multiply or divide b by 10 and recurse<BR> if p&#062;0 then set r to bintens(<A HREF="Floats.html#binmult">binmult</A>(b,"1010"),p-1,m)<BR> else r=bintens(<A HREF="Floats.html#bindiv">bindiv</A>(b,"1010",m),p+1,m)<BR> return r.char&#091;1..m&#093;<BR>end<BR><HR><A NAME="binmult"> </A>on binmult a, b<BR> --! ARGUMENTS: a, b (binary digit strings, possibly floats)<BR> --! RETURNS: a*b in binary<BR> <BR> -- multiply the integer and fraction parts separately<BR> set the itemdelimiter to "."<BR> <BR> set a1 to a.item&#091;1&#093;<BR> if a.item.count&#062;1 then set a2 to a.item&#091;2&#093;<BR> else set a2 to #none<BR> <BR> set b1 to b.item&#091;1&#093;<BR> if b.item.count&#062;1 then set b2 to b.item&#091;2&#093;<BR> else set b2 to #none<BR> <BR> if a2&#060;&#062;#none or b2&#060;&#062;#none then<BR> set m1 to binmult(a1,b1)<BR> if a2&#060;&#062;#none then <BR> set m2 to binmult(a2,b1)<BR> if m2&#060;&#062;"0" then <BR> set len to m2.length - a2.length<BR> set m2 to m2.char&#091;1..len&#093;&"."&m2.char&#091;len+1..m2.length&#093;<BR> end if<BR> else set m2 to "0"<BR> if b2&#060;&#062;#none then <BR> set m3 to binmult(b2,a1)<BR> if m3&#060;&#062;"0" then<BR> set len to m3.length - b2.length<BR> set m3 to m3.char&#091;1..len&#093;&"."&m3.char&#091;len+1..m3.length&#093;<BR> end if<BR> else set m3 to "0"<BR> if a2&#060;&#062;#none and b2&#060;&#062;#none then<BR> set m4 to binmult(a2,b2)<BR> if m4&#060;&#062;"0" then<BR> set len to m4.length - (a2.length + b2.length)<BR> if len&#060;0 then<BR> repeat with i=1 to -len<BR> set m4 to "0"&m4<BR> end repeat<BR> set m4 to "."&m4<BR> else<BR> set m4 to m4.char&#091;1..len&#093;&"."&m4.char&#091;len+1..m4.length&#093;<BR> end if<BR> end if<BR> else set m4 to "0"<BR> return <A HREF="Floats.html#binsum">binsum</A>(<A HREF="Floats.html#binsum">binsum</A>(<A HREF="Floats.html#binsum">binsum</A>(m1,m2),m3),m4)<BR> end if<BR> <BR> -- set sum to 0<BR> set s to "0"<BR> -- ensure a is shorter than b (for speed of calculation)<BR> if a.length&#060;b.length then<BR> set c to a<BR> set a to b<BR> set b to c<BR> end if<BR> -- For each element c of b (working backwards)<BR> repeat with i=b.length down to 1<BR> set c to b.char&#091;i&#093;<BR> -- if c is 1 then add a to sum<BR> if c="1" then set s to <A HREF="Chapter 1.html#addbinarystrings">addbinarystrings</A>(s,a)<BR> -- append "0" to the end of a<BR> set a to a&"0"<BR> end repeat<BR> -- return the sum<BR> return s<BR>end<BR><HR><A NAME="binsum"> </A>on binsum a, b<BR> --! ARGUMENTS: a, b (binary digit strings, possibly floats)<BR> --! RETURNS: a+b in binary<BR> -- add the integer and fraction parts separately<BR> set the itemdelimiter to "."<BR> <BR> set a1 to a.item&#091;1&#093;<BR> if a.item.count&#062;1 then set a2 to a.item&#091;2&#093;<BR> else set a2 to #none<BR> <BR> set b1 to b.item&#091;1&#093;<BR> if b.item.count&#062;1 then set b2 to b.item&#091;2&#093;<BR> else set b2 to #none<BR> <BR> set s1 to <A HREF="Chapter 1.html#addBinaryStrings">addBinaryStrings</A>(a1,b1)<BR> if a2&#060;&#062;#none and b2&#060;&#062;#none then<BR> -- make a2 and b2 the same length with zeros<BR> repeat while a2.length&#060;b2.length<BR> set a2 to a2&"0"<BR> end repeat<BR> repeat while a2.length&#062;b2.length<BR> set b2 to b2&"0"<BR> end repeat<BR> -- add them together<BR> set s2 to <A HREF="Chapter 1.html#addBinaryStrings">addBinaryStrings</A>(a2,b2)<BR> -- carry any extra digits onto s1<BR> if s2.length&#062;a2.length then<BR> set len to s2.length-a2.length<BR> set s1 to <A HREF="Chapter 1.html#addBinaryStrings">addBinaryStrings</A>(s1,s2.char&#091;1..len&#093;)<BR> set s2 to s2.char&#091;len+1..s2.length&#093;<BR> end if<BR> <BR> else if a2&#060;&#062;#none then<BR> set s2 to a2<BR> else if b2&#060;&#062;#none then<BR> set s2 to b2<BR> else<BR> return s1<BR> end if<BR> return s1&"."&s2<BR>end<BR><HR><A NAME="bindiv"> </A>on bindiv a, b, m<BR> --! ARGUMENTS: a, b (binary digit strings, possibly floats), m (positive integer)<BR> --! RETURNS: a/b in binary, to m 'decimal places'<BR> <BR> -- start by multiplying both numbers by 2 until b is an integer<BR> set the itemdelimiter to "."<BR> if b.item.count&#062;1 then<BR> set mult to b.item&#091;2&#093;.length<BR> if a.item.count=1 then<BR> repeat with i=1 to mult<BR> set a to a&"0"<BR> end repeat<BR> else<BR> set a2 to a.item&#091;2&#093;<BR> set len to a2.length-mult<BR> if len&#062;0 then<BR> set a to a.item&#091;1&#093;&a2.char&#091;1..len&#093;&"."&a2.char&#091;len+1..a2.length&#093;<BR> else<BR> set a to a.item&#091;1&#093;&a2<BR> repeat with i=1 to -len<BR> set a to a&"0"<BR> end repeat<BR> end if<BR> end if<BR> set b to b.item&#091;1&#093;&b.item&#091;2&#093;<BR> end if<BR> <BR> set output to ""<BR> set div to ""<BR> set st to 0 -- when st=0 we don't write zeros<BR> set radix to 0 -- radix point not reached<BR> if voidp(m) then set m to 100<BR> repeat while output.length&#060;m or not radix<BR> if a.length=0 then set c to "0"<BR> else <BR> set c to a.char&#091;1&#093;<BR> delete a.char&#091;1&#093;<BR> if c="." then <BR> if st=0 then set output to "0"<BR> set output to output&"."<BR> set st to 1<BR> set c to a.char&#091;1&#093;<BR> delete a.char&#091;1&#093;<BR> set radix to 1<BR> end if<BR> <BR> if a.length=0 and not radix then set pt to 1<BR> end if<BR> <BR> set div to div&c<BR> if <A HREF="Floats.html#binequals">binequals</A>(div,b) then<BR> -- exact multiple<BR> set st to 1<BR> set output to output&"1"<BR> if a.length=0 then return output<BR> set div to ""<BR> else if <A HREF="Chapter 1.html#bingreater">bingreater</A>(div,b) then<BR> -- some remainder<BR> set st to 1<BR> set output to output&"1"<BR> set div to <A HREF="Chapter 1.html#subtractbinarystrings">subtractbinarystrings</A>(div,b)<BR> else<BR> if st then set output to output&"0"<BR> end if<BR> if pt then -- beyond the original length of a<BR> -- things are easier here: we know the dividend is all 0's<BR> repeat with i=1 to div.length<BR> f=0<BR> if div.char&#091;i&#093;="1" then<BR> if st=0 then set output to "0"<BR> set output to output&"."<BR> set st to 1<BR> set f to 1<BR> exit repeat<BR> end if<BR> end repeat<BR> if f=0 then return output<BR> set pt to 0<BR> end if<BR> <BR> end repeat<BR> return output<BR>end<BR><HR><A NAME="binequals"> </A>on binequals a, b<BR> --! ARGUMENTS: a, b (binary digit strings, possibly floats), m (positive integer)<BR> --! RETURNS: true if and only if a=b<BR> <BR> -- remove leading 0's<BR> repeat while a.char&#091;1&#093;="0"<BR> delete a.char&#091;1&#093;<BR> end repeat<BR> repeat while b.char&#091;1&#093;="0"<BR> delete b.char&#091;1&#093;<BR> end repeat<BR> -- remove trailing 0's after the radix point<BR> if a contains "." then<BR> repeat while a.char&#091;a.length&#093;="0"<BR> delete a.char&#091;a.length&#093;<BR> if a.char&#091;a.length&#093;="." then<BR> delete a.char&#091;a.length&#093;<BR> exit repeat<BR> end if<BR> end repeat<BR> end if<BR> if b contains "." then<BR> repeat while b.char&#091;b.length&#093;="0"<BR> delete b.char&#091;b.length&#093;<BR> if b.char&#091;b.length&#093;="." then<BR> delete b.char&#091;b.length&#093;<BR> exit repeat<BR> end if<BR> end repeat<BR> end if<BR> -- return 1 if and only if a=b<BR> return a=b<BR>end<BR><HR><A NAME="mantissaexponent"> </A>on mantissaexponent x, p <BR> --! ARGUMENTS: x, p (integers) <BR> --! RETURNS: a list &#091;mantissa, exponent&#093; for x*10^p<BR> b=<A HREF="Floats.html#decbin">decbin</A>(x)<BR> s=<A HREF="Floats.html#bintens">bintens</A>(b,p,200)<BR> e=0<BR> m=""<BR> f=0<BR> repeat with i=1 to s.length<BR> c=s.char&#091;i&#093;<BR> if c="." then<BR> if f=0 then f=-1<BR> else<BR> m=m&s.char&#091;(i+1)..s.length&#093;<BR> exit repeat<BR> end if<BR> <BR> else if f=-1 then<BR> e=e-1<BR> if c="1" then<BR> m=s.char&#091;i..s.length&#093;<BR> exit repeat<BR> end if<BR> else if f=1 then<BR> e=e+1<BR> m=m&c<BR> else<BR> if c="1" then<BR> f=1<BR> m="1"<BR> end if<BR> end if<BR> end repeat<BR> repeat while m.length&#060;24<BR> m=m&"0"<BR> end repeat<BR> <BR> return &#091;m.char&#091;1..24&#093;,e&#093;<BR>end<BR><HR></KBD><P><A HREF="math index.html">Back to index</A></PRE></BODY></HTML> 