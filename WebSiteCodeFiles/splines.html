<HTML><HEAD><TITLE>splines functions</TITLE></HEAD><BODY><H2 ALIGN="center">Functions for cast member "splines" of castlib "math"</H2><P><PRE><KBD><A NAME="drawbeziercurve"> </A>on drawBezierCurve nodes, im<BR> --! ARGUMENTS: nodes (list of property lists &#091;#node:, #ctrl:&#093;)<BR> --! control points stored as relative positions, im (image object)<BR> --! RETURNS: image with curve drawn in<BR> if nodes.count&#060;2 then return im<BR> set pt to nodes&#091;1&#093;.node<BR> repeat with i=2 to nodes.count<BR> -- calculate bezier cubic coefficients for this curve segment<BR> set n1 to nodes&#091;i-1&#093;.node<BR> set n2 to nodes&#091;i&#093;.node<BR> set c1 to n1+nodes&#091;i-1&#093;.ctrl<BR> set c2 to n2-nodes&#091;i&#093;.ctrl<BR> set c to 3*(c1-n1)<BR> set b to 3*(c2-c1)-c<BR> set a to n2-n1-b-c<BR> -- draw curve in 20 increments<BR> repeat with j=1 to 20<BR> set t to j*0.05<BR> set p to a*t*t*t+b*t*t+c*t+n1<BR> im.draw(p,pt,rgb(0,0,0))<BR> set pt to p<BR> end repeat<BR> end repeat<BR> return im<BR>end<BR><HR><A NAME="drawcatmullcurve"> </A>on drawCatmullCurve nodes, im<BR> --! ARGUMENTS: nodes (list of property lists &#091;#node:&#093;), im (image object)<BR> --! RETURNS: image with curve drawn in<BR> if nodes.count&#060;4 then return im<BR> set pt to nodes&#091;2&#093;.node<BR> <BR> repeat with i=3 to nodes.count-1<BR> -- calculate cubic coefficients for this curve segment<BR> set n0 to nodes&#091;i-2&#093;.node<BR> set n1 to nodes&#091;i-1&#093;.node<BR> set n2 to nodes&#091;i&#093;.node<BR> set n3 to nodes&#091;i+1&#093;.node<BR> set a to (-n0+3*n1-3*n2+n3)/2<BR> set b to (2*n0-5*n1+4*n2-n3)/2<BR> set c to (-n0+n2)/2<BR> -- draw curve in 20 increments<BR> repeat with j=1 to 20<BR> set t to j*0.05<BR> set p to a*t*t*t+b*t*t+c*t+n1<BR> im.draw(pt,p,rgb(0,0,0))<BR> set pt to p<BR> end repeat<BR> end repeat<BR> return im<BR>end<BR><HR><A NAME="NURBSbasisFunction"> </A>on NURBSbasisFunction i, j, t, knotvector<BR> --! ARGUMENTS: i, j (integers), t (point to be evaluated), knotvector (list of knot positions)<BR> --! RETURNS: the value of the basis function N(i,j) at t<BR> if j=0 then<BR> if t&#060;knotvector&#091;i+1&#093; then return 0<BR> if t&#062;=knotvector&#091;i+2&#093; then return 0<BR> return 1<BR> end if<BR> -- otherwise recurse<BR> if (knotvector&#091;i+j+1&#093;-knotvector&#091;i+1&#093;)=0 then set a to 0<BR> else set a to (t-knotvector&#091;i+1&#093;)/(knotvector&#091;i+j+1&#093;-knotvector&#091;i+1&#093;)<BR> if (knotvector&#091;i+j+2&#093;-knotvector&#091;i+2&#093;)=0 then set b to 0<BR> else set b to (knotvector&#091;i+j+2&#093;-t)/(knotvector&#091;i+j+2&#093;-knotvector&#091;i+2&#093;)<BR> return a*NURBSbasisFunction(i,j-1,t,knotvector)+b*NURBSbasisFunction(i+1,j-1,t,knotvector)<BR>end<BR><HR><A NAME="NURBScurvePoint"> </A>on NURBScurvePoint t, knotvector, nodes, weights<BR> --! ARGUMENTS: t (number), knotvector (list of knot values),<BR> --! nodes (positions of control points), weights (weights of control points)<BR> --! RETURNS: the coordinates of the point on the curve with parameter t<BR> <BR> set k to knotvector.count-nodes.count-1<BR> set p to nodes.count-1<BR> set v to point(0,0)<BR> set w to 0<BR> repeat with i=0 to p<BR> set n to <A HREF="splines.html#NURBSbasisFunction">NURBSbasisFunction</A>(i,k,t,knotvector)<BR> if n=0 then next repeat<BR> set w to w+weights&#091;i+1&#093;*n<BR> set v to v+nodes&#091;i+1&#093;*weights&#091;i+1&#093;*n<BR> end repeat<BR> if w=0 then return point(0,0)<BR> return v/w<BR>end<BR><HR><A NAME="NURBSsurfacePoint"> </A>on NURBSsurfacePoint s, t, knotvector1, knotvector2, nodes, weights<BR> --! ARGUMENTS: s, t (numbers), knotvector1, knotvector2 (lists of knot values),<BR> --! nodes (positions of control points (2d array)), weights (weights of control points (2d array))<BR> --! RETURNS: the coordinates of the point on the surface with parameters s, t<BR> <BR> set k to knotvector1.count-nodes.count-1<BR> set l to knotvector2.count-nodes&#091;1&#093;.count-1<BR> set p to nodes.count-1<BR> set q to nodes&#091;1&#093;.count-1<BR> set v to vector(0,0,0)<BR> set w to 0<BR> repeat with i=0 to p<BR> repeat with j=0 to q<BR> set n1 to <A HREF="splines.html#NURBSbasisFunction">NURBSbasisFunction</A>(i,k,s,knotvector1)<BR> set n2 to <A HREF="splines.html#NURBSbasisFunction">NURBSbasisFunction</A>(j,l,t,knotvector2)<BR> if n1=0 and n2=0 then next repeat<BR> set w to w+weights&#091;i+1&#093;&#091;j+1&#093;*n1*n2<BR> set v to v+nodes&#091;i+1&#093;&#091;j+1&#093;*weights&#091;i+1&#093;&#091;j+1&#093;*n1*n2<BR> end repeat<BR> end repeat<BR> return v/w<BR>end<BR><HR></KBD><P><A HREF="math index.html">Back to index</A></PRE></BODY></HTML> 