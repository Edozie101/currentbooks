<HTML><HEAD><TITLE>3d world functions</TITLE></HEAD><BODY><H2 ALIGN="center">Functions for cast member "3d world" of castlib "simple3D"</H2><P><PRE><KBD><A NAME="draw3D"> </A>on draw3D me<BR> f=pfaces.duplicate()<BR> repeat with i=f.count down to 1<BR> if f&#091;i&#093;&#091;5&#093;.dot(f&#091;i&#093;&#091;6&#093;-pobserverPos)&#062;=0 then f.deleteat(i)<BR> end repeat<BR> verts=&#091;&#093;<BR> repeat with fc in f<BR> repeat with i=1 to 4<BR> if not verts.getone(fc&#091;i&#093;) then verts.add(fc&#091;i&#093;)<BR> end repeat<BR> end repeat<BR> <BR> pdrawvertices=&#091;&#093;<BR> repeat with vert in verts<BR> v=pvertices&#091;vert&#093;<BR> pdrawvertices.add(pos3DToScreenPos(v, pobserverPos, pobserverVect, pobserverUp, pfov, ph)+pcenter)<BR> end repeat<BR> im=pimage.duplicate()<BR> repeat with l in plines<BR> p1=verts.getpos(l&#091;1&#093;) <BR> p2=verts.getpos(l&#091;2&#093;)<BR> if p1=0 or p2=0 then next repeat<BR> im.draw(pdrawvertices&#091;p1&#093;,pdrawvertices&#091;p2&#093;,rgb(0,0,0))<BR> end repeat<BR> pmember.image=im<BR>end<BR><HR><A NAME="beginSprite"> </A>on beginsprite me<BR> pmember=sprite(me.spritenum).member<BR> pimage=image((the activewindow).rect.width,(the activewindow).rect.height,16)<BR> pmember.image=pimage<BR> pfov=pi/12<BR> ph=pimage.height/2<BR> pcenter=sprite(me.spritenum).loc<BR> me.<A HREF="3d world.html#init">init</A>()<BR> me.<A HREF="3d world.html#draw3D">draw3D</A>()<BR>end<BR><HR><A NAME="init"> </A>on init me<BR> pvertices=&#091;&#093;<BR> plines=&#091;&#093;<BR> pfaces=&#091;&#093;<BR> me.<A HREF="3d world.html#addCube">addCube</A>(vector(0,0,0))<BR> pobserverpos=vector(100,0,-100)<BR> pobservervect=vector(-1,0,1).getnormalized()<BR> pobserverup=vector(0,1,0)<BR>end<BR><HR><A NAME="addCube"> </A>on addCube me, c<BR> t=pvertices.count<BR> repeat with i in &#091;-1,1&#093;<BR> repeat with j in &#091;-1,1&#093;<BR> repeat with k in &#091;-1,1&#093;<BR> pvertices.add(vector(i,j,k)*10+c)<BR> end repeat<BR> end repeat<BR> end repeat<BR> plines.add(&#091;1,2&#093;+t)<BR> plines.add(&#091;1,3&#093;+t)<BR> plines.add(&#091;2,4&#093;+t)<BR> plines.add(&#091;3,4&#093;+t)<BR> plines.add(&#091;5,6&#093;+t)<BR> plines.add(&#091;5,7&#093;+t)<BR> plines.add(&#091;6,8&#093;+t)<BR> plines.add(&#091;7,8&#093;+t)<BR> plines.add(&#091;1,5&#093;+t)<BR> plines.add(&#091;2,6&#093;+t)<BR> plines.add(&#091;3,7&#093;+t)<BR> plines.add(&#091;4,8&#093;+t)<BR> pfaces.add(&#091;1+t,2+t,3+t,4+t,vector(-1,0,0),c+10*vector(-1,0,0)&#093;)--left face<BR> pfaces.add(&#091;1+t,2+t,5+t,6+t,vector(0,-1,0),c+10*vector(0,-1,0)&#093;)--top face<BR> pfaces.add(&#091;1+t,3+t,5+t,7+t,vector(0,0,-1),c+10*vector(0,0,-1)&#093;)--front face<BR> pfaces.add(&#091;5+t,6+t,7+t,8+t,vector(1,0,0),c+10*vector(1,0,0)&#093;)--right face<BR> pfaces.add(&#091;3+t,4+t,7+t,8+t,vector(0,1,0),c+10*vector(0,1,0)&#093;)--bottom face<BR> pfaces.add(&#091;2+t,4+t,6+t,8+t,vector(0,0,1),c+10*vector(0,0,1)&#093;)--back face<BR>end<BR><HR><A NAME="exitFrame"> </A>on exitframe me<BR> r=0<BR> if keypressed(123) then r=1<BR> if keypressed(124) then r=r-1<BR> if r then<BR> me.<A HREF="3d world.html#rotateObserver">rotateObserver</A>(r)<BR> end if<BR> if keypressed(125) then f=-1<BR> if keypressed(126) then f=1<BR> if f then<BR> me.<A HREF="3d world.html#zoomObserver">zoomObserver</A>(f)<BR> end if<BR> <BR> if keypressed("a") then s=-1<BR> if keypressed("s") then s=1<BR> if s then<BR> me.<A HREF="3d world.html#panObserver">panObserver</A>(s)<BR> end if<BR> if r or f or s then me.<A HREF="3d world.html#draw3D">draw3D</A>()<BR>end<BR><HR><A NAME="rotateobserver"> </A>on rotateobserver me, r<BR> ang=r*pi/60<BR> v=pobserverVect.cross(pobserverUp)<BR> pobserverVect=pobserverVect*cos(ang)+v*sin(ang)<BR>end<BR><HR><A NAME="zoomobserver"> </A>on zoomobserver me, f<BR> pobserverPos=pobserverPos+5*f*pobserverVect<BR>end<BR><HR><A NAME="panobserver"> </A>on panobserver me, s<BR> pobserverPos=pobserverPos-5*s*crossProduct(pobserverVect, pobserverUp)<BR>end<BR><HR><A NAME="mouseDown"> </A>on mouseDown me<BR> v=screenPosTo3DPos(the clickloc-pcenter, pobserverVect, pobserverUp, pfov, ph)<BR> me.<A HREF="3d world.html#addCube">addCube</A>(pobserverPos+(20+random(100))*norm(v))<BR> me.<A HREF="3d world.html#draw3d">draw3d</A>()<BR>end<BR><HR></KBD><P><A HREF="simple3D index.html">Back to index</A></PRE></BODY></HTML> 